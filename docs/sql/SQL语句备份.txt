select 
			user_id 
		from 
			user_wallet a 
		where 
			currency_id = #{currencyId}
		and 
			(
				legal_balance 
				+ 
				(select sum(caution_money) as money from lever_transaction cwhere c.user_id = a.user_id and legal=2)
			)
			<
			(
				select 
					sum
					(
						if
						(
							type=2
							,(update_price-price)*number
							,(price-update_price)*number
						)
					) 
					as 
					m 
					from 
						lever 
					where 
						legal=#{currencyId} 
					and 
						user_id 
					in 
						(
							select 
								user_id 
							from 
								lever_transaction b
							where 
								a.user_id = b.user_id 
							and 
								b.legal=2 #{currencyId}
							and 
								(
									(type=1 and update_price<price and (price-update_price)*number>=caution_money*0.7) 
									or 
									(type=2 and update_price>price and (update_price-price)*number>=caution_money*0.7)
								)
						)
				GROUP BY user_id
			)
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
select 
			user_id 
		from 
			user_wallets a 
		where 
			currency_id = 1
		and 
			(
				(
					lever_balance 
					+ 
					(
						select 
							sum(caution_money) as money 
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id = 1
					)
					+
					(
						select 
							sum(
								if
								(
									type=2
									,(now_price-price)*number
									,(price-now_price)*number
								)
							)
							as 
							m
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id =1
					)
				)
				/
				(
						select 
							sum(caution_money) as money 
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id = 1
					)
			)
			<
			0.7
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
select 
			user_id 
		from 
			user_wallets a 
		where 
			currency_id = 1
		and 
			(
				(
					lever_balance 
					+ 
					(
						select 
							sum(caution_money) as money 
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id = 1
					)
					+
					(
						select 
							sum(
								if
								(
									type=1
									,(now_price-price)*number
									,(price-now_price)*number
								)
							)
							as 
							m
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id =1
					)
				)
				/
				(
						select 
							sum(caution_money) as money 
						from 
							lever c
						where 
							c.user_id = a.user_id 
						and 
							legal_id = 1
					)
			)
			<
			0.7